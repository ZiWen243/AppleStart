<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        const support_lang = ['中文', '汉语', '英语', '法语', '德语', '俄语', '拉丁语', '日语', '韩语', '意大利语', '葡萄牙语']
        const lang_dic = {
            '中文': 'zh-CN',
            '汉语': 'zh-CN',
            '英语': 'en',
            '法语': 'fr',
            '德语': 'de',
            '俄语': 'ru',
            '拉丁语': 'la',
            '日语': 'ja',
            '韩语': 'ko',
            '意大利语': 'it',
            '葡萄牙语': 'pt',
        }
        const length_unit = {
            "m": 1,
            "meter": 1,
            "meters": 1,
            "cm": 0.01,
            "dm": 0.1,
            "mm": 0.001,
            "km": 1000,
            "inch": 0.0254,
            "inches": 0.0254,
            "ft": 0.3048,
            "mile": 1609.344,
            "miles": 1609.344,
            "米": 1,
            "厘米": 0.01,
            "分米": 0.1,
            "毫米": 0.001,
            "千米": 1000,
            "公里": 1000,
            "里": 500,
            "英寸": 0.0254,
            "英尺": 0.3048,
            "英里": 1609.344
        }
        const data_unit = {
            "b": 0.125,
            "B": 1,
            "Kb": 128,
            "KB": 1024,
            "Mb": 131072,
            "MB": 1048576,
            "Gb": 134217728,
            "GB": 1073741824
        }

        function link(url) { window.open(url); }

        function smart_sug(text) {
            if (text.indexOf('什么是') == 0) {
                var word = text.replace("什么是", "");
                var result_sug = document.createElement('div');
                result_sug.setAttribute("class", "suggestion");
                result_sug.textContent = "在百度百科中搜索:" + word;
                result_sug.setAttribute("onclick", "link('https://baike.baidu.com/search?word=" + word + "&pn=0&rn=0&enc=utf8')")
                document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
            }
            if (text.indexOf('翻译') == 0) {
                if (text.indexOf(' ') != -1) {
                    var splited_text = text.split(" ");
                    splited_text.clean('');
                    splited_text.push(['']);
                    console.debug(splited_text);
                    if (splited_text.length >= 3) {
                        var plain_txt = splited_text[1];
                        var target_lang = splited_text[2];
                        if (splited_text[2] == "") {
                            var result_sug = document.createElement('div');
                            result_sug.setAttribute("class", "suggestion");
                            var word_display = plain_txt;
                            if (plain_txt.length >= 40)
                                word_display = plain_txt.substr(0, 37) + "...";
                            result_sug.textContent = "翻译" + word_display;
                            result_sug.setAttribute("onclick", "link('https://translate.google.cn/?sl=auto&tl=zh-CN&text=" + plain_txt + "&op=translate')")
                            document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
                        }
                        if (lang_dic[target_lang] != null) {
                            var result_sug = document.createElement('div');
                            result_sug.setAttribute("class", "suggestion");
                            var word_display = plain_txt;
                            if (plain_txt.length >= 40)
                                word_display = plain_txt.substr(0, 37) + "...";
                            result_sug.textContent = "将" + word_display + "翻译为" + target_lang;
                            result_sug.setAttribute("onclick", "link('https://translate.google.cn/?sl=auto&tl=" + lang_dic[target_lang] + "&text=" + plain_txt + "&op=translate')")
                            document.getElementById("suggestions").insertBefore(result_sug, document.getElementBy3Id("suggestions").children[0]);
                        }
                    }
                }
            }
            else {
                for (var i = 0; i < support_lang.length; i++) {
                    if (text.indexOf(support_lang[i]) != -1) {
                        var word = text.replace(support_lang[i], "");
                        word = word.replace("的", "");
                        var result_sug = document.createElement('div');
                        result_sug.setAttribute("class", "suggestion");
                        result_sug.textContent = "将" + word + "翻译为" + support_lang[i];
                        result_sug.setAttribute("onclick", "link('https://translate.google.cn/?sl=auto&tl=" + lang_dic[support_lang[i]] + "&text=" + word + "&op=translate')")
                        document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
                        break;
                    }
                }
            }

            if (text.indexOf('.') != -1) {
                var result_sug = document.createElement('div');
                result_sug.setAttribute("class", "suggestion");
                var word_display = text;
                text = text.replace("http://", "");
                text = text.replace("https://", "");
                if (text.length >= 60)
                    word_display = text.substr(0, 59) + "...";
                result_sug.textContent = "访问:" + word_display;
                result_sug.setAttribute("onclick", "link('http://" + text + "')")
                document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
            }

            //普通的空格分隔
            if (text.indexOf(' ') != -1) {
                var splited_text = text.split(" ");
                splited_text.clean('');
                splited_text.clean('in');
                splited_text.clean('to');
                if (splited_text.length >= 3) {
                    //长度单位判断
                    if (length_unit.hasOwnProperty(splited_text[1]) && length_unit.hasOwnProperty(splited_text[2])) {
                        var result = "" + parseFloat((splited_text[0] * length_unit[splited_text[1]] / length_unit[splited_text[2]]).toFixed(8));
                        result = result.replace("NaN", "错误");
                        var result_sug = document.createElement('div');
                        result_sug.setAttribute("class", "suggestion");
                        result_sug.textContent = result;
                        document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
                    }
                    else if (data_unit.hasOwnProperty(splited_text[1]) && data_unit.hasOwnProperty(splited_text[2])) {
                        var result = "" + parseFloat((splited_text[0] * data_unit[splited_text[1]] / data_unit[splited_text[2]]).toFixed(8));
                        result = result.replace("NaN", "错误");
                        var result_sug = document.createElement('div');
                        result_sug.setAttribute("class", "suggestion");
                        result_sug.textContent = result;
                        document.getElementById("suggestions").insertBefore(result_sug, document.getElementById("suggestions").children[0]);
                    }
                }
            }
        }

        function clear_sug() {
            for (var i = 0; i < 10; i++) {
                var sg = document.getElementById('suggestions').children[i+1];
                sg.textContent = "";
                sg.removeAttribute("onclick");
                sg.removeAttribute("enable");
            }
        }

        function onesearch() {
            clear_sug();
            keyword = document.getElementById("search").value;
            if (keyword.length == 0)
                clear_sug();
            oScript = document.createElement('script');
            oScript.src = "http://suggestion.baidu.com/su?wd=" + keyword + "&cb=suggestion";
            document.body.appendChild(oScript);
            document.body.removeChild(oScript);
        }
        Array.prototype.clean = function (deleteValue) {
            for (var i = 0; i < this.length; i++) {
                if (this[i] == deleteValue) {
                    this.splice(i, 1);
                    i--;
                }
            }
            return this;
        };
        function suggestion(data) {
            for (var i = 0; i < Math.max(10, data.s.length); i++) {
                var new_sg = document.getElementById('suggestions').children[i+1];
                new_sg.textContent = data.s[i];
                new_sg.setAttribute("onclick", "search('" + data.s[i] + "')");
                new_sg.setAttribute("enable","");
            }
        }
        function HttpGet(theUrl) {
            var xmlHttp = null;
            xmlHttp = new XMLHttpRequest();
            xmlHttp.withCredentials = true;
            xmlHttp.open("get", theUrl, true);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

    </script>
    <link rel="stylesheet" href="style/onesearch.css">


    <title>OneSearch</title>
</head>


<body id="body" class="body">

    <div class="title">OneSearch</div>

    <!-- 搜索框 -->
    <input class="search" type="text" name="search" id="search" placeholder="易搜" oninput="onesearch()">

    <!-- 搜索联想 -->
    <div class="suggestions" id="suggestions">
        <div class="sug_title">搜索建议</div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
        <div class="suggestion" enable=""></div>
    </div>


</body>

</html>